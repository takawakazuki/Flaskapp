{% extends "base.html" %}
{% block content %}
<h2>メイン画面</h2>

<!-- 🔽 月選択フォーム -->
<form method="get" action="/">
  <label for="month">表示する月を選択：</label>
  <input type="month" id="month" name="month" value="{{ selected_month }}">
  <input type="submit" value="表示">
</form>

<!-- 🔽 乗車履歴テーブル -->
{% if ride_list %}
<h3>{{ selected_month }} の乗車履歴</h3>

<div style="overflow-x: auto;">
  <table style="min-width: 700px; border-collapse: collapse; width: 100%;">
    <thead>
      <tr>
        <th style="border: 1px solid #ccc; padding: 8px;">日付</th>
        <th style="border: 1px solid #ccc; padding: 8px;">曜日</th>
        <th style="border: 1px solid #ccc; padding: 8px;">行き</th>
        <th style="border: 1px solid #ccc; padding: 8px;">帰り</th>
        <th style="border: 1px solid #ccc; padding: 8px;">操作</th>
      </tr>
    </thead>
    <tbody>
      {% for ride in ride_list %}
      <tr>
        <td style="border: 1px solid #ccc; padding: 8px;">{{ ride.date }}</td>
        <td style="border: 1px solid #ccc; padding: 8px;">{{ ride.weekday }}</td>
        <td style="border: 1px solid #ccc; padding: 8px;">
          {{ ride.go_location }}（{% if ride.go_driver %}運転{% else %}同乗{% endif %}）
        </td>
        <td style="border: 1px solid #ccc; padding: 8px;">
          {{ ride.back_location }}（{% if ride.back_driver %}運転{% else %}同乗{% endif %}）
        </td>
        <td style="border: 1px solid #ccc; padding: 8px;">
          <a href="/{{ ride.id }}/edit">編集</a> |
          <a href="/{{ ride.id }}/delete">削除</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<p>{{ selected_month }} の乗車情報が登録されていません。</p>
{% endif %}



<!-- 🔽 新規登録ボタン（未登録日のみ） -->
{% set date_str = selected_month + '-01' %}
{% if date_str not in already_registered_dates %}
  <div style="margin-top: 1em;">
    <a href="/regist?date={{ date_str }}" class="btn">＋ 新規登録</a>
  </div>
{% endif %}

<!-- 🔽 精算確認ボタン（常に一番下） -->
<div style="margin-top: 2em;">
  <a href="/settlement" class="btn">💰 精算確認</a>
</div>

<!-- 🔽 全体精算確認ボタン（追加） -->
<div style="margin-top: 1em;">
  <a href="/settlement_all" class="btn">📊 全体精算確認</a>
</div>

<!-- 🔽 ログアウトボタン（右上風に固定） -->
<div style="text-align: right; margin-bottom: 1em;">
  <a href="/logout" class="btn">🔓 ログアウト</a>
</div>


{% endblock %}
